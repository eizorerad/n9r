# Implementation Plan

- [x] 1. Add lizard dependency and create LizardAnalyzer class
  - [x] 1.1 Add lizard to pyproject.toml dependencies
    - Add `lizard = "^1.17.10"` to project dependencies
    - Run `uv sync` to install
    - _Requirements: 8.1, 8.4_
  - [x] 1.2 Create LizardAnalyzer class in new file `backend/app/services/lizard_analyzer.py`
    - Create dataclasses: `LizardFunctionMetrics`, `LizardAnalysisResult`
    - Implement `analyze()` method that runs lizard CLI with JSON output
    - Implement `_run_lizard()` to execute subprocess and parse JSON
    - Implement `_calculate_rank()` for CC to grade conversion (A-F)
    - Handle subprocess errors gracefully
    - _Requirements: 1.1, 1.2, 1.5, 8.1_
  - [ ]* 1.3 Write property test for LizardAnalyzer
    - **Property 1: JS/TS files produce non-zero complexity metrics**
    - **Validates: Requirements 1.1, 1.2, 1.3**

- [x] 2. Integrate lizard into RepoAnalyzer
  - [x] 2.1 Add `_detect_languages()` method to RepoAnalyzer
    - Scan repository for file extensions
    - Return set of detected languages
    - _Requirements: 4.1_
  - [x] 2.2 Add `analyze_with_lizard()` method to RepoAnalyzer
    - Call LizardAnalyzer for non-Python files
    - Return metrics dict compatible with existing structure
    - Handle lizard not installed gracefully
    - _Requirements: 1.1, 1.2, 8.3_
  - [x] 2.3 Add `_merge_complexity_results()` method to RepoAnalyzer
    - Sum complexity_distribution counts from radon and lizard
    - Calculate weighted average complexity
    - Combine and sort top_complex_functions
    - Build by_language breakdown
    - _Requirements: 4.2, 4.3, 4.4, 5.1, 5.2_
  - [ ]* 2.4 Write property test for complexity distribution merging
    - **Property 3: Merged complexity distribution equals sum of parts**
    - **Validates: Requirements 4.2**
  - [ ]* 2.5 Write property test for weighted average calculation
    - **Property 4: Weighted average complexity is correctly calculated**
    - **Validates: Requirements 4.3**

- [x] 3. Update analyze() method to use multi-language analysis
  - [x] 3.1 Modify `analyze()` in RepoAnalyzer to orchestrate both analyzers
    - Detect languages present in repo
    - Run radon for Python files (existing code)
    - Run lizard for non-Python files (new)
    - Merge results using `_merge_complexity_results()`
    - Add by_language to returned metrics
    - _Requirements: 4.1, 5.1_
  - [x] 3.2 Update AnalysisResult metrics dict to include by_language
    - Add by_language field with per-language breakdown
    - Ensure backward compatibility with existing fields
    - _Requirements: 5.1, 5.2_
  - [ ]* 3.3 Write property test for top_complex_functions sorting
    - **Property 2: Top complex functions are sorted by complexity descending**
    - **Validates: Requirements 1.4, 4.4**
  - [ ]* 3.4 Write property test for by_language filtering
    - **Property 5: by_language contains only languages with files**
    - **Validates: Requirements 5.1, 5.2, 5.4**

- [x] 4. Checkpoint - Make sure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 5. Implement graceful degradation
  - [x] 5.1 Add error handling for radon failures
    - Catch radon subprocess errors
    - Log error and continue with lizard results
    - Return partial results with warning
    - _Requirements: 6.1, 6.3_
  - [x] 5.2 Add error handling for lizard failures
    - Catch lizard subprocess errors
    - Log error and continue with radon results
    - Return partial results with warning
    - _Requirements: 6.2, 6.3_
  - [x] 5.3 Add fallback for both analyzers failing
    - Return basic file/line counts with zero complexity
    - Log appropriate error message
    - _Requirements: 6.5_
  - [ ]* 5.4 Write property test for partial results
    - **Property 6: Partial results on analyzer failure**
    - **Validates: Requirements 6.1, 6.2, 6.4**

- [x] 6. Frontend: Add "By Language" card
  - [x] 6.1 Update TypeScript interface in analysis-metrics.tsx
    - Add `by_language` field to AnalysisMetricsProps interface
    - Define per-language data structure
    - _Requirements: 5.3_
  - [x] 6.2 Add getLanguageIcon helper function
    - Map language names to emoji icons
    - Handle unknown languages with default icon
    - _Requirements: 5.3_
  - [x] 6.3 Add "By Language" Card component
    - Create new Card showing per-language breakdown
    - Display language icon, name, files, lines, avg complexity
    - Only render when by_language data is available
    - _Requirements: 5.3, 5.5_

- [x] 7. Update Playground page to show new metrics
  - [x] 7.1 Update ScanResult interface in playground/page.tsx
    - Add by_language to metrics type
    - _Requirements: 5.3_
  - [x] 7.2 Display by_language breakdown in playground results
    - Show language breakdown when available
    - _Requirements: 5.3, 5.5_

- [ ] 8. Final Checkpoint - Make sure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 9. Documentation updates
  - [x] 9.1 Update architecture.md with tool selection rationale
    - Document why lizard was chosen over escomplex
    - Document radon vs lizard responsibilities
    - _Requirements: 8.5_
  - [x] 9.2 Update glossary.md with new terms
    - Add lizard definition
    - Add by_language explanation
    - _Requirements: 8.5_
